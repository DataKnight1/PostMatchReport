"""
Report Generator
Main module for generating complete match reports using ETL and Visual components.
"""

import matplotlib.pyplot as plt
import pandas as pd
from typing import Dict, Any, Optional, Tuple
import os

from ETL.loaders.data_loader import DataLoader
from ETL.transformers.match_processor import MatchProcessor
from Visual.pitch_visualizations import PitchVisualizations
from Visual.statistical_visualizations import StatisticalVisualizations
from Visual.heatmap_visualizations import HeatmapVisualizations
from Visual.advanced_visualizations import AdvancedVisualizations
from Visual.tactical_visualizations import TacticalVisualizer


class ReportGenerator:
    """Generate comprehensive match reports."""

    def __init__(self, cache_dir: str = "./cache", theme: str = 'dark'):
        """
        Initialize report generator.

        Args:
            cache_dir: Directory for caching data
            theme: 'dark' or 'light'
        """
        self.cache_dir = cache_dir
        self.data_loader = DataLoader(cache_dir)

        # Initialize visualization modules
        self.theme = theme.lower()
        if self.theme == 'dark':
            self.bg_color = '#0e1117'
            self.text_color = 'white'
            pitch_color = '#0e1117'
            line_color = '#e6e6e6'
        else:
            self.bg_color = '#f0f0f0'
            self.text_color = 'black'
            pitch_color = '#d6c39f'
            line_color = '#0e1117'

        self.pitch_viz = PitchVisualizations(pitch_color=pitch_color, line_color=line_color)
        self.stats_viz = StatisticalVisualizations()
        self.heatmap_viz = HeatmapVisualizations()
        self.advanced_viz = AdvancedVisualizations(pitch_color=pitch_color, line_color=line_color)
        self.tactical_viz = TacticalVisualizer()

    def generate_report(self, whoscored_id: int, fotmob_id: Optional[int] = None,
                       output_file: Optional[str] = None, use_cache: bool = True,
                       dpi: int = 150, figsize: Tuple[int, int] = (20, 22)) -> plt.Figure:
        """
        Generate complete match report.

        Args:
            whoscored_id: WhoScored match ID
